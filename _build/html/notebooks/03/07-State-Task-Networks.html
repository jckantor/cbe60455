
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Scheduling Multipurpose Batch Processes using State-Task Networks &#8212; CBE 40455/60455 Process Operations</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Optimization under Uncertainty" href="../04/00-uncertainty.html" />
    <link rel="prev" title="Job Shop Scheduling" href="03-job-shop-scheduling.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">CBE 40455/60455 Process Operations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    CBE 40555/60455 Process Operations
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01/syllabus.html">
   CBE 40455/60455 Process Operations: Syllabus
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/00-discrete-event-modeling.html">
   Introduction to Discrete Event Simulation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/01-simpy.html">
     Introduction to Simpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/02-agent-based-models.html">
     Agent Based Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/03-queuing-systems.html">
     Simulating Queuing Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/04-batch-process-prompt.html">
     Batch Chemical Process
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="00-scheduling.html">
   Scheduling
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01-critical-path-method.html">
     Critical Path Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="02-machine-bottleneck.html">
     Machine Bottleneck
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-job-shop-scheduling.html">
     Job Shop Scheduling
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Scheduling Multipurpose Batch Processes using State-Task Networks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/00-uncertainty.html">
   Optimization under Uncertainty
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/vendor-problem.html">
     The Vendor Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/farmer-project.html">
     Solving the Farmer’s problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../05/00-finance.html">
   Financial Risk and Diversification
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/01-measuring-return.html">
     Measuring Return
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/03-binomial-model-for-pricing-options.html">
     Binomial Model for Pricing Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/04-real-options.html">
     Real Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/05-portfolio-optimization.html">
     Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/06-portfolio-optimization-using-mean-absolute-deviation.html">
     Portfolio Optimization using Mean Absolute Deviation
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/07-MAD-portfolio-optimization.html">
     Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/08-Log-Optimal-Growth-and-the-Kelly-Criterion.html">
     Log-Optimal Growth and the Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../05/09-Log-Optimal-Portfolios.html">
     Log-Optimal Portfolios
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jckantor/cbe60455/main?urlpath=tree/notebooks/03/07-State-Task-Networks.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/jckantor/cbe60455/blob/main/notebooks/03/07-State-Task-Networks.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jckantor/cbe60455"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jckantor/cbe60455/issues/new?title=Issue%20on%20page%20%2Fnotebooks/03/07-State-Task-Networks.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/03/07-State-Task-Networks.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-kondili-et-al-1993">
   Example (Kondili, et al., 1993)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#encoding-stn-data">
   Encoding STN data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-a-time-grid">
     Setting a Time Grid
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mathematical-model">
   Mathematical Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#organizing-problem-data-structures">
   Organizing Problem Data Structures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-time">
     Characterizing Time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-tasks">
     Characterizing Tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-states">
     Characterizing States
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-the-processing-units">
     Characterizing the Processing Units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pyomo-model">
     Pyomo Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#profitability">
     Profitability
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-inventories">
     State Inventories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-assignment">
     Unit Assignment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-batch-inventories">
     Unit Batch Inventories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gannt-chart">
     Gannt Chart
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trace-of-events-and-states">
   Trace of Events and States
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Scheduling Multipurpose Batch Processes using State-Task Networks</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#bibliographic-notes">
   Bibliographic Notes
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-kondili-et-al-1993">
   Example (Kondili, et al., 1993)
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#exercise">
     Exercise
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#encoding-stn-data">
   Encoding STN data
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-a-time-grid">
     Setting a Time Grid
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mathematical-model">
   Mathematical Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#organizing-problem-data-structures">
   Organizing Problem Data Structures
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-time">
     Characterizing Time
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-tasks">
     Characterizing Tasks
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-states">
     Characterizing States
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#characterizing-the-processing-units">
     Characterizing the Processing Units
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pyomo-model">
     Pyomo Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#analysis">
   Analysis
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#profitability">
     Profitability
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#state-inventories">
     State Inventories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-assignment">
     Unit Assignment
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#unit-batch-inventories">
     Unit Batch Inventories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gannt-chart">
     Gannt Chart
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#trace-of-events-and-states">
   Trace of Events and States
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="scheduling-multipurpose-batch-processes-using-state-task-networks">
<h1>Scheduling Multipurpose Batch Processes using State-Task Networks<a class="headerlink" href="#scheduling-multipurpose-batch-processes-using-state-task-networks" title="Permalink to this headline">#</a></h1>
<p>The State-Task Network (STN) is an approach to modeling multipurpose batch process for the purpose of short term scheduling. It was first developed by Kondili, et al., in 1993, and subsequently developed and extended by others.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pyomo.environ</span> <span class="kn">import</span> <span class="o">*</span>
</pre></div>
</div>
</div>
</div>
<section id="bibliographic-notes">
<h2>Bibliographic Notes<a class="headerlink" href="#bibliographic-notes" title="Permalink to this headline">#</a></h2>
<p>Original development –</p>
<ul class="simple">
<li><p>Kondili, E., Pantelides, C. C., &amp; Sargent, R. W. H. (1993). A general algorithm for short-term scheduling of batch operations—I. MILP formulation. Computers &amp; Chemical Engineering, 17(2), 211-227. [<a class="reference external" href="https://www.researchgate.net/profile/Roger-Sargent/publication/222159161_A_General_Algorithm_for_Short-Term_Scheduling_of_Batch_Operations-i_MILP_Formulation/links/5a19d9be0f7e9be37f9a5af1/A-General-Algorithm-for-Short-Term-Scheduling-of-Batch-Operations-i-MILP-Formulation.pdf">pdf</a>]</p></li>
<li><p>Shah, N., Pantelides, C. C., &amp; Sargent, R. W. H. (1993). A general algorithm for short-term scheduling of batch operations—II. Computational issues. Computers &amp; chemical engineering, 17(2), 229-244. [<a class="reference external" href="https://www.sciencedirect.com/science/article/abs/pii/009813549380016G">pdf</a>]</p></li>
</ul>
<p>Process applications and further developments –</p>
<ul class="simple">
<li><p>[<a class="reference external" href="https://www.eq.uc.pt/~marco/eps/Edicao_2016_2017/Aulas_12_15/Pantelides_1994.pdf">pdf</a>]</p></li>
<li><p>Floudas, C. A., &amp; Lin, X. (2005). Mixed integer linear programming in process scheduling: Modeling, algorithms, and applications. Annals of Operations Research, 139(1), 131-162.</p></li>
<li><p>Harjunkoski, I., Maravelias, C. T., Bongers, P., Castro, P. M., Engell, S., Grossmann, I. E., … &amp; Wassick, J. (2014). Scope for industrial applications of production scheduling models and solution methods. Computers &amp; Chemical Engineering, 62, 161-193.</p></li>
<li><p>Méndez, C. A., Cerdá, J., Grossmann, I. E., Harjunkoski, I., &amp; Fahl, M. (2006). State-of-the-art review of optimization methods for short-term scheduling of batch processes. Computers &amp; Chemical Engineering, 30(6), 913-946.</p></li>
<li><p>Wassick, J. M., &amp; Ferrio, J. (2011). Extending the resource task network for industrial applications. Computers &amp; chemical engineering, 35(10), 2124-2140. [<a class="reference external" href="https://reader.elsevier.com/reader/sd/pii/S0098135411000123">pdf</a>]</p></li>
</ul>
<p>Supply chain applications –</p>
<ul class="simple">
<li><p>Castro, P. M., Sun, L., &amp; Harjunkoski, I. (2013). Resource–task network formulations for industrial demand side management of a steel plant. Industrial &amp; Engineering Chemistry Research, 52(36), 13046-13058. [<a class="reference external" href="https://pubs.acs.org/doi/full/10.1021/ie401044q">pubs.acs.org</a>]</p></li>
<li><p>Ba, B. H., Prins, C., &amp; Prodhon, C. (2018). A generic tactical planning model to supply a biorefinery with biomass. Pesquisa Operacional, 38, <a class="reference external" href="http://1-30.Ba">1-30.Ba</a>, B. H., Prins, C., &amp; Prodhon, C. (2018). A generic tactical planning model to supply a biorefinery with biomass. Pesquisa Operacional, 38, 1-30. [<a class="reference external" href="https://www.scielo.br/j/pope/a/wrqnhVjLs9xS34YMzwt9Hsf/abstract/?lang=enhttps://www.scielo.br/j/pope/a/wrqnhVjLs9xS34YMzwt9Hsf/abstract/?lang=en">pdf</a>]</p></li>
</ul>
<p>Python Coding Examples –</p>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/jckantor/STN-Scheduler">STN-Scheduler</a></p></li>
</ul>
</section>
<section id="example-kondili-et-al-1993">
<h2>Example (Kondili, et al., 1993)<a class="headerlink" href="#example-kondili-et-al-1993" title="Permalink to this headline">#</a></h2>
<p>A state-task network is a graphical representation of the activities in a multiproduct batch process. The representation includes the minimum details needed for short term scheduling of batch operations.</p>
<p>A well-studied example due to Kondili (1993) is shown below. Other examples are available in the references cited above.</p>
<p><img alt="Screen%20Shot%202017-09-16%20at%209.45.36%20PM.png" src="https://jckantor.github.io/CBE30338/figures/Kondili_1993.png" /></p>
<p>Each circular node in the diagram designates material in a particular state.  The materials are generally held in suitable vessels with a known capacity. The relevant information for each state is the initial inventory, storage capacity, and the unit price of the material in each state. The price of materials in intermediate states may be assigned penalities in order to minimize the amount of work in progress.</p>
<p>The rectangular nodes denote process tasks. When scheduled for execution, each task is assigned an appropriate piece of equipment, and assigned a batch of material according to the incoming arcs. Each incoming arc begins at a state where the associated label indicates the mass fraction of the batch coming from that particular state. Outgoing arcs indicate the disposition of the batch to product states. The outgoing are labels indicate the fraction of the batch assigned to each product state, and the time necessary to produce that product.</p>
<p>Not shown in the diagram is the process equipment used to execute the tasks. A separate list of process units is available, each characterized by a capacity and list of tasks which can be performed in that unit.</p>
<section id="exercise">
<h3>Exercise<a class="headerlink" href="#exercise" title="Permalink to this headline">#</a></h3>
<ol class="simple">
<li><p>Read this reciped for Hollandaise Sauce: <a class="reference external" href="http://www.foodnetwork.com/recipes/tyler-florence/hollandaise-sauce-recipe-1910043">http://www.foodnetwork.com/recipes/tyler-florence/hollandaise-sauce-recipe-1910043</a>. Assume the available equipment consists of one sauce pan and a double-boiler on a stove. Draw a state-task network outlining the basic steps in the recipe.</p></li>
<li><p>A few months ago you were given process development responsibilities for a start-up company that is attempting to commercialize a novel fermentation technology.  The fermentation produces high-value medicinal products based on an engineered micro-organism. During you short time on the job, you have already developed and commissioned a pilot plant comprised of the following basic operations:</p></li>
</ol>
<ul class="simple">
<li><p>Enzymatic digestion of the fermentation substrate.  This operation requires a feed of 20% substrate (S), 79% water (W), and 1% enzyme (E). The digestion requires 1 working day to complete all steps. Assume the substrate costs \<span class="math notranslate nohighlight">\(2/kg, the enzyme is \\\)</span>20/kg, and water is essentially free.  You acquired a mixer/blender unit for this purpose that can operate on any quantity up to 100 kg.  The product of the digestion operation is called the “wort”. To avoid contamination of the process, wort cannot be stored before use.</p></li>
<li><p>Digestion is followed by fermentation. The fermentation requires four working day for completion upon which the substrate is entirely consumed.  For this operation, you purchased a 100 liter (kg) fermentor that is working quite well. The product is a turbid suspension that is 20% solids.</p></li>
<li><p>A batch filtration operation separates the turbid suspension into a clarified intermediate product called “beer” (80%)  and a solid by-product (20%)  that can be sold for \$2/kg.  The filtration device you purchased can handle 100 kg/batch. But the operation has turned out to be messy with frequent equipment breakdown. For planning purposes, you can plan on both products to be ready in 1 working day, but need to plan for additional working day for cleanup and maintenance of the equipment.</p></li>
<li><p>Following coarse filtration, a novel selective membrane separator is used to separate the beer into a product (P) valued at \<span class="math notranslate nohighlight">\(200/kg and a contaminated waste-water stream that costs \\\)</span>2/kg to dispose. The product recovery is 5 mass % of the incoming liquid. The membrane separator was designed to handle 100 kg/day.</p></li>
</ul>
<p>Create a State-Task Network describing the pilot plant operation as it exists today.</p>
</section>
</section>
<section id="encoding-stn-data">
<h2>Encoding STN data<a class="headerlink" href="#encoding-stn-data" title="Permalink to this headline">#</a></h2>
<p>The basic data structure specifies the states, tasks, and units comprising a state-task network. The intention is for all relevant problem data to be contained in a single JSON-like structure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># planning horizon</span>
<span class="n">H</span> <span class="o">=</span> <span class="mi">10</span>

<span class="c1"># STN Data Structure</span>
<span class="n">Kondili</span> <span class="o">=</span> <span class="p">{</span>
    <span class="c1"># time grid</span>
    <span class="s1">&#39;TIME&#39;</span><span class="p">:</span>  <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="o">+</span><span class="mi">1</span><span class="p">)),</span>
    
    <span class="c1"># states</span>
    <span class="s1">&#39;STATES&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s1">&#39;Feed_A&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_B&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Feed_C&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">},</span>
        <span class="s1">&#39;Hot_A&#39;</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Int_AB&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Int_BC&#39;</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">150</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Impure_E&#39;</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Product_1&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">10</span><span class="p">},</span>
        <span class="s1">&#39;Product_2&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;capacity&#39;</span><span class="p">:</span> <span class="mi">500</span><span class="p">,</span> <span class="s1">&#39;initial&#39;</span><span class="p">:</span>   <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;price&#39;</span><span class="p">:</span>  <span class="mi">1000</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># state to task arcs indexed by (state, task)</span>
    <span class="s1">&#39;ST_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Feed_A&#39;</span><span class="p">,</span>   <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_B&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Feed_C&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Hot_A&#39;</span><span class="p">,</span>    <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_AB&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Int_BC&#39;</span><span class="p">,</span>   <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Impure_E&#39;</span><span class="p">,</span> <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># task to state arcs indexed by (task, state)</span>
    <span class="s1">&#39;TS_ARCS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heating&#39;</span><span class="p">,</span>    <span class="s1">&#39;Hot_A&#39;</span><span class="p">)</span>    <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.6</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_BC&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reaction_3&#39;</span><span class="p">,</span> <span class="s1">&#39;Impure_E&#39;</span><span class="p">)</span> <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">1.0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Int_AB&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Separation&#39;</span><span class="p">,</span> <span class="s1">&#39;Product_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;dur&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;rho&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">},</span>
    <span class="p">},</span>
    
    <span class="c1"># unit data indexed by (unit, task)</span>
    <span class="s1">&#39;UNIT_TASKS&#39;</span><span class="p">:</span> <span class="p">{</span>
        <span class="p">(</span><span class="s1">&#39;Heater&#39;</span><span class="p">,</span>    <span class="s1">&#39;Heating&#39;</span><span class="p">)</span>   <span class="p">:</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">100</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_1&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_1&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_2&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Reactor_2&#39;</span><span class="p">,</span> <span class="s1">&#39;Reaction_3&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span>  <span class="mi">80</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="p">(</span><span class="s1">&#39;Still&#39;</span><span class="p">,</span>     <span class="s1">&#39;Separation&#39;</span><span class="p">):</span> <span class="p">{</span><span class="s1">&#39;Bmin&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Bmax&#39;</span><span class="p">:</span> <span class="mi">200</span><span class="p">,</span> <span class="s1">&#39;Cost&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;vCost&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Tclean&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<section id="setting-a-time-grid">
<h3>Setting a Time Grid<a class="headerlink" href="#setting-a-time-grid" title="Permalink to this headline">#</a></h3>
<p>The following computations can be done on any time grid, including real-valued time points. TIME is a list of time points commencing at 0.</p>
</section>
</section>
<section id="mathematical-model">
<h2>Mathematical Model<a class="headerlink" href="#mathematical-model" title="Permalink to this headline">#</a></h2>
<p>The following Pyomo model closely follows the development in Kondili, et al. (1993). In particular, the first step in the model is to process the STN data to create sets as given in Kondili.</p>
<p>One important difference from Kondili is the adoption of a more natural time scale that starts at <span class="math notranslate nohighlight">\(t = 0\)</span> and extends to <span class="math notranslate nohighlight">\(t = H\)</span> (rather than from 1 to H+1).</p>
<p>A second difference is the introduction of an additional decision variable denoted by <span class="math notranslate nohighlight">\(Q_{j,t}\)</span> indicating the amount of material in unit <span class="math notranslate nohighlight">\(j\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>. A material balance then reads</p>
<p>\begin{align*}
Q_{jt} &amp; = Q_{j(t-1)} + \sum_{i\in I_j}B_{ijt} - \sum_{i\in I_j}\sum_{\substack{s \in \bar{S}<em>i\s\ni t-P</em>{is} \geq 0}}\bar{\rho}<em>{is}B</em>{ij(t-P_{is})} \qquad \forall j,t
\end{align*}</p>
<p>Following Kondili’s notation, <span class="math notranslate nohighlight">\(I_j\)</span> is the set of tasks that can be performed in unit <span class="math notranslate nohighlight">\(j\)</span>, and <span class="math notranslate nohighlight">\(\bar{S}_i\)</span> is the set of states fed by task <span class="math notranslate nohighlight">\(j\)</span>. We assume the units are empty at the beginning and end of production period, i.e.,</p>
<p>\begin{align*}
Q_{j(-1)} &amp; = 0 \qquad \forall j \
Q_{j,H} &amp; = 0 \qquad \forall j
\end{align*}</p>
<p>The unit allocation constraints are written the full backward aggregation method described by Shah (1993).  The allocation constraint reads</p>
<p>\begin{align*}
\sum_{i \in I_j} \sum_{t’=t}^{t-p_i+1} W_{ijt’} &amp; \leq 1 \qquad \forall j,t
\end{align*}</p>
<p>Each processing unit <span class="math notranslate nohighlight">\(j\)</span> is tagged with a minimum and maximum capacity, <span class="math notranslate nohighlight">\(B_{ij}^{min}\)</span> and <span class="math notranslate nohighlight">\(B_{ij}^{max}\)</span>, respectively, denoting the minimum and maximum batch sizes for each task <span class="math notranslate nohighlight">\(i\)</span>. A minimum capacity may be needed to cover heat exchange coils in a reactor or mixing blades in a blender, for example. The capacity may depend on the nature of the task being performed.  These constraints are written</p>
<p>\begin{align*}
B_{ij}^{min}W_{ijt} &amp; \leq B_{ijt} \leq  B_{ij}^{max}W_{ijt} \qquad \forall j, \forall i\in I_j, \forall t
\end{align*}</p>
</section>
<section id="organizing-problem-data-structures">
<h2>Organizing Problem Data Structures<a class="headerlink" href="#organizing-problem-data-structures" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">STN</span> <span class="o">=</span> <span class="n">Kondili</span>

<span class="n">STATES</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;STATES&#39;</span><span class="p">]</span>
<span class="n">ST_ARCS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;ST_ARCS&#39;</span><span class="p">]</span>
<span class="n">TS_ARCS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;TS_ARCS&#39;</span><span class="p">]</span>
<span class="n">UNIT_TASKS</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;UNIT_TASKS&#39;</span><span class="p">]</span>
<span class="n">TIME</span> <span class="o">=</span> <span class="n">STN</span><span class="p">[</span><span class="s1">&#39;TIME&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<section id="characterizing-time">
<h3>Characterizing Time<a class="headerlink" href="#characterizing-time" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">H</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterizing-tasks">
<h3>Characterizing Tasks<a class="headerlink" href="#characterizing-tasks" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of all tasks </span>
<span class="n">TASKS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">i</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">])</span>

<span class="c1"># S[i] set of states which feed task i</span>
<span class="n">S</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">:</span>
    <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># S_[i] set of states fed by task i</span>
<span class="n">S_</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">:</span>
    <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>

<span class="c1"># rho[(i, s)] input fraction of task i from state s</span>
<span class="n">rho</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="n">ST_ARCS</span><span class="p">[(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)][</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">}</span>

<span class="c1"># rho_[(i,s)] output fraction of task i to state s</span>
<span class="n">rho_</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="n">TS_ARCS</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)][</span><span class="s1">&#39;rho&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">}</span>

<span class="c1"># P[(i,s)] time for task i output to state s </span>
<span class="n">P</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">):</span> <span class="n">TS_ARCS</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)][</span><span class="s1">&#39;dur&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">}</span>  

<span class="c1"># p[i] completion time for task i</span>
<span class="n">p</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">max</span><span class="p">([</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]])</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>

<span class="c1"># K[i] set of units capable of task i</span>
<span class="n">K</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">:</span>
    <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">j</span><span class="p">)</span> 

<span class="c1"># verify</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;TASK </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">   duration = </span><span class="si">{</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">4.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Input State </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">    rho = </span><span class="si">{</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Output State </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">    rho = </span><span class="si">{</span><span class="n">rho_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">   dur = </span><span class="si">{</span><span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;            Unit </span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">   </span><span class="si">{</span><span class="n">UNIT_TASKS</span><span class="p">[(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>TASK Separation   duration =  2.0
     Input State Impure_E      rho =   1.0
    Output State Int_AB        rho =   0.1   dur =   2.0
    Output State Product_2     rho =   0.9   dur =   1.0
            Unit Still        {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 200, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}

TASK Reaction_2   duration =  2.0
     Input State Int_BC        rho =   0.6
     Input State Hot_A         rho =   0.4
    Output State Int_AB        rho =   0.6   dur =   2.0
    Output State Product_1     rho =   0.4   dur =   2.0
            Unit Reactor_2    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}
            Unit Reactor_1    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}

TASK Reaction_1   duration =  2.0
     Input State Feed_C        rho =   0.5
     Input State Feed_B        rho =   0.5
    Output State Int_BC        rho =   1.0   dur =   2.0
            Unit Reactor_2    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}
            Unit Reactor_1    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}

TASK Reaction_3   duration =  1.0
     Input State Int_AB        rho =   0.8
     Input State Feed_C        rho =   0.2
    Output State Impure_E      rho =   1.0   dur =   1.0
            Unit Reactor_2    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}
            Unit Reactor_1    {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 80, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}

TASK Heating      duration =  1.0
     Input State Feed_A        rho =   1.0
    Output State Hot_A         rho =   1.0   dur =   1.0
            Unit Heater       {&#39;Bmin&#39;: 0, &#39;Bmax&#39;: 100, &#39;Cost&#39;: 1, &#39;vCost&#39;: 0, &#39;Tclean&#39;: 0}
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterizing-states">
<h3>Characterizing States<a class="headerlink" href="#characterizing-states" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># T[s] set of tasks receiving material from state s </span>
<span class="n">T</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">ST_ARCS</span><span class="p">:</span>
    <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># set of tasks producing material for state s</span>
<span class="n">T_</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span> <span class="ow">in</span> <span class="n">TS_ARCS</span><span class="p">:</span>
    <span class="n">T_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># C[s] storage capacity for state s</span>
<span class="n">C</span> <span class="o">=</span> <span class="p">{</span><span class="n">s</span><span class="p">:</span> <span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;capacity&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">}</span>

<span class="c1"># verify</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">STATE </span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">  capacity = </span><span class="si">{</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">  ic = </span><span class="si">{</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">  price = </span><span class="si">{</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">]</span><span class="si">:</span><span class="s2">5.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T_</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Input from task </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Output to task </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>STATE Feed_A      capacity = 500.0  ic = 500.0  price =  0.00
     Output to task Heating   

STATE Feed_B      capacity = 500.0  ic = 500.0  price =  0.00
     Output to task Reaction_1

STATE Feed_C      capacity = 500.0  ic = 500.0  price =  0.00
     Output to task Reaction_3
     Output to task Reaction_1

STATE Hot_A       capacity = 100.0  ic =   0.0  price = -10.00
    Input from task Heating   
     Output to task Reaction_2

STATE Int_AB      capacity = 200.0  ic =   0.0  price = -10.00
    Input from task Separation
    Input from task Reaction_2
     Output to task Reaction_3

STATE Int_BC      capacity = 150.0  ic =   0.0  price = -10.00
    Input from task Reaction_1
     Output to task Reaction_2

STATE Impure_E    capacity = 100.0  ic =   0.0  price = -10.00
    Input from task Reaction_3
     Output to task Separation

STATE Product_1   capacity = 500.0  ic =   0.0  price = 10.00
    Input from task Reaction_2

STATE Product_2   capacity = 500.0  ic =   0.0  price = 1000.00
    Input from task Separation
</pre></div>
</div>
</div>
</div>
</section>
<section id="characterizing-the-processing-units">
<h3>Characterizing the Processing Units<a class="headerlink" href="#characterizing-the-processing-units" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set of all units</span>
<span class="n">UNITS</span> <span class="o">=</span> <span class="nb">set</span><span class="p">([</span><span class="n">j</span> <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">_</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">])</span>

<span class="c1"># create indexed set where I[j] is the set of tasks performed with unit j</span>
<span class="n">I</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:</span> <span class="nb">set</span><span class="p">()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">}</span>
<span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">:</span>
    <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>

<span class="c1"># Bmin[(i, j)] minimum capacity of unit j for task i</span>
<span class="n">Bmin</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="n">UNIT_TASKS</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Bmin&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">}</span>

<span class="c1"># Bmax[(i, j)] maximum capacity of unit j for task i</span>
<span class="n">Bmax</span> <span class="o">=</span> <span class="p">{(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="n">UNIT_TASKS</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Bmax&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">UNIT_TASKS</span><span class="p">}</span>


<span class="c1"># verify</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UNIT </span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   TASK </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">   Bmin = </span><span class="si">{</span><span class="n">Bmin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">5.2f</span><span class="si">}</span><span class="s2">    Bmax = </span><span class="si">{</span><span class="n">Bmax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span> 
        
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UNIT Reactor_2 
   TASK Reaction_3   Bmin =  0.00    Bmax =  80.0
   TASK Reaction_2   Bmin =  0.00    Bmax =  80.0
   TASK Reaction_1   Bmin =  0.00    Bmax =  80.0

UNIT Reactor_1 
   TASK Reaction_3   Bmin =  0.00    Bmax =  80.0
   TASK Reaction_2   Bmin =  0.00    Bmax =  80.0
   TASK Reaction_1   Bmin =  0.00    Bmax =  80.0

UNIT Heater    
   TASK Heating      Bmin =  0.00    Bmax = 100.0

UNIT Still     
   TASK Separation   Bmin =  0.00    Bmax = 200.0
</pre></div>
</div>
</div>
</div>
</section>
<section id="pyomo-model">
<h3>Pyomo Model<a class="headerlink" href="#pyomo-model" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">m</span> <span class="o">=</span> <span class="n">ConcreteModel</span><span class="p">()</span>

<span class="c1"># W[i, j, t] logical variable to start task i starts on unit j at time t</span>
<span class="n">m</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">Boolean</span><span class="p">)</span>

<span class="c1"># B[i, j, t,] size of batch assigned to task i on unit j at time t</span>
<span class="n">m</span><span class="o">.</span><span class="n">B</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="c1"># S[s, t] inventory of state s from t to t+1</span>
<span class="n">m</span><span class="o">.</span><span class="n">S</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>

<span class="c1"># Q[j,t] inventory of unit j from time t to t+1</span>
<span class="n">m</span><span class="o">.</span><span class="n">Q</span> <span class="o">=</span> <span class="n">Var</span><span class="p">(</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">,</span> <span class="n">domain</span><span class="o">=</span><span class="n">NonNegativeReals</span><span class="p">)</span>           

<span class="c1"># Objective is to maximize the value of the final state (see Kondili, Sec. 5)</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Expression</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">value_of_states</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;price&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">H</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">])</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Expression</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">cost_of_operation</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">([</span><span class="n">UNIT_TASKS</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Cost&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">])</span> <span class="o">+</span> \
           <span class="nb">sum</span><span class="p">([</span><span class="n">UNIT_TASKS</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;vCost&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">])</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Objective</span><span class="p">(</span><span class="n">sense</span><span class="o">=</span><span class="n">maximize</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">profit</span><span class="p">(</span><span class="n">m</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">value_of_states</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">cost_of_operation</span>

<span class="c1"># state capacity constraint</span>
<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">STATES</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">state_capacity</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

<span class="c1"># unit capacity constraints</span>
<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unit_capacity_min</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span> <span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bmin</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">TASKS</span><span class="p">,</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unit_capacity_max</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]</span> <span class="o">*</span> <span class="n">Bmax</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">Constraint</span><span class="o">.</span><span class="n">Skip</span>

<span class="c1"># constraint to avoid assigning j to more than one task at time t</span>
<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">assignment</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="k">return</span> <span class="mi">1</span> <span class="o">&gt;=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">tp</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">tp</span> <span class="ow">in</span> <span class="n">TIME</span> <span class="k">if</span> <span class="n">tp</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="n">t</span> <span class="o">-</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">UNIT_TASKS</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">][</span><span class="s1">&#39;Tclean&#39;</span><span class="p">])</span> <span class="ow">and</span> <span class="n">tp</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="p">)</span>

<span class="c1"># mass balances on each state</span>
<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">STATES</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">state_balance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">mass_in</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rho_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T_</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">])</span>
    <span class="n">mass_out</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rho</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">T</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">K</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">TIME</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">mass_in</span> <span class="o">-</span> <span class="n">mass_out</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mass_in</span> <span class="o">-</span> <span class="n">mass_out</span>

<span class="c1"># mass balance on each unit</span>
<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">UNITS</span><span class="p">,</span> <span class="n">TIME</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">unit_balance</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">):</span>
    <span class="n">mass_in</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>
    <span class="n">mass_out</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">rho_</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">]</span> <span class="o">*</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">]]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">if</span> <span class="n">t</span> <span class="o">&gt;=</span> <span class="n">P</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">TIME</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">mass_in</span> <span class="o">-</span> <span class="n">mass_out</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]</span> <span class="o">==</span> <span class="n">m</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">mass_in</span> <span class="o">-</span> <span class="n">mass_out</span>

<span class="nd">@m</span><span class="o">.</span><span class="n">Constraint</span><span class="p">(</span><span class="n">UNITS</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">terminal</span><span class="p">(</span><span class="n">m</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">m</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">H</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span>

<span class="n">SolverFactory</span><span class="p">(</span><span class="s1">&#39;cbc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">solve</span><span class="p">(</span><span class="n">m</span><span class="p">)</span><span class="o">.</span><span class="n">write</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span># ==========================================================
# = Solver Results                                         =
# ==========================================================
# ----------------------------------------------------------
#   Problem Information
# ----------------------------------------------------------
Problem: 
- Name: unknown
  Lower bound: 194457.66666667
  Upper bound: 194457.66666667
  Number of objectives: 1
  Number of constraints: 123
  Number of variables: 175
  Number of binary variables: 88
  Number of integer variables: 88
  Number of nonzeros: 93
  Sense: maximize
# ----------------------------------------------------------
#   Solver Information
# ----------------------------------------------------------
Solver: 
- Status: ok
  User time: -1.0
  System time: 0.26
  Wallclock time: 0.33
  Termination condition: optimal
  Termination message: Model was solved to optimality (subject to tolerances), and an optimal solution is available.
  Statistics: 
    Branch and bound: 
      Number of bounded subproblems: 0
      Number of created subproblems: 0
    Black box: 
      Number of iterations: 82
  Error rc: 0
  Time: 0.39389705657958984
# ----------------------------------------------------------
#   Solution Information
# ----------------------------------------------------------
Solution: 
- number of solutions: 0
  number of solutions displayed: 0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Unit Schedules</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">UNIT </span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2"> Start  Finish     Batch&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">TASKS</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span> 
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    </span><span class="si">{</span><span class="n">i</span><span class="si">:</span><span class="s2">10s</span><span class="si">}</span><span class="s2">    </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">     </span><span class="si">{</span><span class="n">t</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">     </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>UNIT Heater     Start  Finish     Batch
    Heating         1       2      64.0
    Heating         4       5      42.7

UNIT Reactor_1  Start  Finish     Batch
    Reaction_1      0       2      80.0
    Reaction_2      2       4      80.0
    Reaction_3      4       5      40.0
    Reaction_2      5       7      26.7
    Reaction_3      7       8      15.0

UNIT Reactor_2  Start  Finish     Batch
    Reaction_1      0       2      80.0
    Reaction_2      2       4      80.0
    Reaction_3      4       5      80.0
    Reaction_2      5       7      80.0
    Reaction_3      7       8      80.0

UNIT Still      Start  Finish     Batch
    Separation      5       7     120.0
    Separation      8      10      95.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;   Time   &quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  </span><span class="si">{</span><span class="n">j</span><span class="si">:</span><span class="s2">&gt;8s</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    </span><span class="si">{</span><span class="n">t</span><span class="si">:</span><span class="s2">3d</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;      </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span><span class="si">:</span><span class="s2">5.1f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   Time       Heater  Reactor_1  Reactor_2     Still
      0        0.0       80.0       80.0        0.0
      1       64.0       80.0       80.0        0.0
      2        0.0       80.0       80.0        0.0
      3        0.0       80.0       80.0        0.0
      4       42.7       40.0       80.0        0.0
      5        0.0       26.7       80.0      120.0
      6        0.0       26.7       80.0       12.0
      7        0.0       15.0       80.0        0.0
      8        0.0        0.0        0.0       95.0
      9        0.0        0.0        0.0        9.5
     10        0.0        0.0        0.0        0.0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>

<span class="n">gap</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="mi">500</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">lbls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
        <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2"> -&gt; </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">],[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span> <span class="o">+</span> <span class="n">gap</span><span class="p">,</span> <span class="n">t</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">gap</span><span class="p">],</span> <span class="p">[</span><span class="n">idx</span><span class="p">,</span> <span class="n">idx</span><span class="p">],</span> <span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]())</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t</span> <span class="o">+</span> <span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">lbls</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-State-Task-Networks_23_0.png" src="../../_images/07-State-Task-Networks_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">STATES</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">AttributeError</span><span class="g g-Whitespace">                            </span>Traceback (most recent call last)
<span class="nn">Input In [54],</span> in <span class="ni">&lt;cell line: 3&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">STATES</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="ne">----&gt; </span><span class="mi">3</span> <span class="n">df</span><span class="o">.</span><span class="n">display</span><span class="p">()</span>

<span class="nn">File ~/opt/anaconda3/lib/python3.9/site-packages/pandas/core/generic.py:5583,</span> in <span class="ni">NDFrame.__getattr__</span><span class="nt">(self, name)</span>
<span class="g g-Whitespace">   </span><span class="mi">5576</span> <span class="k">if</span> <span class="p">(</span>
<span class="g g-Whitespace">   </span><span class="mi">5577</span>     <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_internal_names_set</span>
<span class="g g-Whitespace">   </span><span class="mi">5578</span>     <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_metadata</span>
<span class="g g-Whitespace">   </span><span class="mi">5579</span>     <span class="ow">and</span> <span class="n">name</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_accessors</span>
<span class="g g-Whitespace">   </span><span class="mi">5580</span>     <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_info_axis</span><span class="o">.</span><span class="n">_can_hold_identifiers_and_holds_name</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<span class="g g-Whitespace">   </span><span class="mi">5581</span> <span class="p">):</span>
<span class="g g-Whitespace">   </span><span class="mi">5582</span>     <span class="k">return</span> <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span>
<span class="ne">-&gt; </span><span class="mi">5583</span> <span class="k">return</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__getattribute__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">)</span>

<span class="ne">AttributeError</span>: &#39;DataFrame&#39; object has no attribute &#39;display&#39;
</pre></div>
</div>
</div>
</div>
<p>import matplotlib.pyplot as plt
import pandas as pd
from IPython.display import display, HTML</p>
</section>
</section>
<section id="analysis">
<h2>Analysis<a class="headerlink" href="#analysis" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span><span class="p">,</span> <span class="n">HTML</span>
</pre></div>
</div>
</div>
</div>
<section id="profitability">
<h3>Profitability<a class="headerlink" href="#profitability" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Value of State Inventories = </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">value_of_states</span><span class="p">()</span><span class="si">:</span><span class="s2">12.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;  Cost of Unit Assignments = </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">cost_of_operation</span><span class="p">()</span><span class="si">:</span><span class="s2">12.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;             Net Objective = </span><span class="si">{</span><span class="n">m</span><span class="o">.</span><span class="n">value_of_states</span><span class="p">()</span> <span class="o">-</span> <span class="n">m</span><span class="o">.</span><span class="n">cost_of_operation</span><span class="p">()</span><span class="si">:</span><span class="s2">12.2f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Value of State Inventories =      2906.67
  Cost of Unit Assignments =        14.00
             Net Objective =      2892.67
</pre></div>
</div>
</div>
</div>
</section>
<section id="state-inventories">
<h3>State Inventories<a class="headerlink" href="#state-inventories" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">STATES</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Feed_A</th>
      <th>Feed_B</th>
      <th>Feed_C</th>
      <th>Hot_A</th>
      <th>Int_AB</th>
      <th>Int_BC</th>
      <th>Impure_E</th>
      <th>Product_1</th>
      <th>Product_2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>500.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>436.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>436.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>436.00000</td>
      <td>420.0</td>
      <td>420.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>0.0</td>
      <td>0.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>396.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.0</td>
      <td>0.0</td>
      <td>64.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>396.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.00000</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>396.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>64.00000</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>377.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.66667</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>377.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.66667</td>
      <td>108.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>377.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.66667</td>
      <td>193.5</td>
    </tr>
    <tr>
      <th>10</th>
      <td>393.33333</td>
      <td>420.0</td>
      <td>377.0</td>
      <td>0.0</td>
      <td>9.5</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>106.66667</td>
      <td>193.5</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">idx</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">STATES</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">STATES</span><span class="p">))):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">STATES</span><span class="p">)</span><span class="o">/</span><span class="mi">3</span><span class="p">),</span> <span class="mi">3</span><span class="p">,</span> <span class="n">idx</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">tlast</span><span class="p">,</span> <span class="n">ylast</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">TIME</span><span class="p">),</span> <span class="p">[</span><span class="n">m</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">]):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">tlast</span><span class="p">,</span> <span class="n">t</span><span class="p">,</span> <span class="n">t</span><span class="p">],</span> <span class="p">[</span><span class="n">ylast</span><span class="p">,</span> <span class="n">ylast</span><span class="p">,</span> <span class="n">y</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>
        <span class="n">tlast</span><span class="p">,</span> <span class="n">ylast</span> <span class="o">=</span> <span class="n">t</span><span class="p">,</span> <span class="n">y</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span><span class="p">],</span> <span class="p">[</span><span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="n">C</span><span class="p">[</span><span class="n">s</span><span class="p">]],</span><span class="s1">&#39;r--&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="n">s</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-State-Task-Networks_31_0.png" src="../../_images/07-State-Task-Networks_31_0.png" />
</div>
</div>
</section>
<section id="unit-assignment">
<h3>Unit Assignment<a class="headerlink" href="#unit-assignment" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">UnitAssignment</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">j</span><span class="p">:[</span><span class="kc">None</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">]</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="n">TIME</span><span class="p">)</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">TIME</span><span class="p">)[</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">TIME</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="n">UnitAssignment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>               
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">UnitAssignment</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t</span><span class="p">,</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]())</span>

<span class="n">UnitAssignment</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Still</th>
      <th>Reactor_1</th>
      <th>Reactor_2</th>
      <th>Heater</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>None</td>
      <td>(Reaction_1, 80.0)</td>
      <td>(Reaction_1, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>1</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>(Heating, 64.0)</td>
    </tr>
    <tr>
      <th>2</th>
      <td>None</td>
      <td>(Reaction_2, 80.0)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>3</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>4</th>
      <td>None</td>
      <td>(Reaction_3, 40.0)</td>
      <td>(Reaction_3, 80.0)</td>
      <td>(Heating, 42.666667)</td>
    </tr>
    <tr>
      <th>5</th>
      <td>(Separation, 120.0)</td>
      <td>(Reaction_2, 26.666667)</td>
      <td>(Reaction_2, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>6</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>7</th>
      <td>None</td>
      <td>(Reaction_3, 15.0)</td>
      <td>(Reaction_3, 80.0)</td>
      <td>None</td>
    </tr>
    <tr>
      <th>8</th>
      <td>(Separation, 95.0)</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>9</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
    <tr>
      <th>10</th>
      <td>None</td>
      <td>None</td>
      <td>None</td>
      <td>None</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="unit-batch-inventories">
<h3>Unit Batch Inventories<a class="headerlink" href="#unit-batch-inventories" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">]</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">],</span> <span class="n">columns</span> <span class="o">=</span> <span class="n">UNITS</span><span class="p">,</span> <span class="n">index</span> <span class="o">=</span> <span class="n">TIME</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Still</th>
      <th>Heater</th>
      <th>Reactor_2</th>
      <th>Reactor_1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>96.0</td>
      <td>80.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>64.0</td>
      <td>160.0</td>
      <td>160.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>160.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>80.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>80.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>8.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>160.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>80.0</td>
      <td>40.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>200.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>20.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="gannt-chart">
<h3>Gannt Chart<a class="headerlink" href="#gannt-chart" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="n">gap</span> <span class="o">=</span> <span class="n">H</span><span class="o">/</span><span class="mi">500</span>
<span class="n">idx</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">lbls</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">UNITS</span><span class="p">):</span>
    <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]):</span>
        <span class="n">idx</span> <span class="o">-=</span> <span class="mi">1</span>
        <span class="n">ticks</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span>
        <span class="n">lbls</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{0:s}</span><span class="s2"> -&gt; </span><span class="si">{1:s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">],[</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">],</span><span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">.3</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">t</span><span class="o">+</span><span class="n">gap</span><span class="p">,</span><span class="n">t</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">gap</span><span class="p">],</span> <span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">idx</span><span class="p">],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">solid_capstyle</span><span class="o">=</span><span class="s1">&#39;butt&#39;</span><span class="p">)</span>
                <span class="n">txt</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{0:.2f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]())</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="n">idx</span><span class="p">,</span> <span class="n">txt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">H</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">lbls</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-State-Task-Networks_37_0.png" src="../../_images/07-State-Task-Networks_37_0.png" />
</div>
</div>
</section>
</section>
<section id="trace-of-events-and-states">
<h2>Trace of Events and States<a class="headerlink" href="#trace-of-events-and-states" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sep</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">--------------------------------------------------------------------------------------------</span><span class="se">\n</span><span class="s1">&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting Conditions&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Initial Inventories:&quot;</span><span class="p">)</span>            
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">STATES</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="s1">&#39;initial&#39;</span><span class="p">]))</span>
        
<span class="n">units</span> <span class="o">=</span> <span class="p">{</span><span class="n">j</span><span class="p">:{</span><span class="s1">&#39;assignment&#39;</span><span class="p">:</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="s1">&#39;t&#39;</span><span class="p">:</span><span class="mi">0</span><span class="p">}</span> <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">}</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">TIME</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Time =&quot;</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="s2">&quot;hr&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Instructions:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1"># transfer from unit to states</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>  
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="n">amt</span> <span class="o">=</span> <span class="n">rho_</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]])]()</span>
                    <span class="k">if</span> <span class="n">amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Transfer&quot;</span><span class="p">,</span> <span class="n">amt</span><span class="p">,</span> <span class="s2">&quot;kg from&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="c1"># release units from tasks</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span><span class="o">-</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]])]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Release&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;from&quot;</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
                    <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;None&#39;</span>
                    <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="c1"># assign units to tasks             </span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Assign&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;with capacity&quot;</span><span class="p">,</span> <span class="n">Bmax</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)],</span> <span class="s2">&quot;kg to task&quot;</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="s2">&quot;for&quot;</span><span class="p">,</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="s2">&quot;hours&quot;</span><span class="p">)</span>
                <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>
                <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="c1"># transfer from states to starting tasks</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">I</span><span class="p">[</span><span class="n">j</span><span class="p">]:</span>
            <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
                <span class="n">amt</span> <span class="o">=</span> <span class="n">rho</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">]()</span>
                <span class="k">if</span> <span class="n">amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
                    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Transfer&quot;</span><span class="p">,</span> <span class="n">amt</span><span class="p">,</span><span class="s2">&quot;kg from&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Inventories are now:&quot;</span><span class="p">)</span>            
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">t</span><span class="p">]()))</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">    Unit Assignments are now:&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">UNITS</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="s1">&#39;None&#39;</span><span class="p">:</span>
            <span class="n">fmt</span> <span class="o">=</span> <span class="s2">&quot;        </span><span class="si">{0:s}</span><span class="s2"> performs the </span><span class="si">{1:s}</span><span class="s2"> task with a </span><span class="si">{2:.2f}</span><span class="s2"> kg batch for hour </span><span class="si">{3:f}</span><span class="s2"> of </span><span class="si">{4:f}</span><span class="s2">&quot;</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;assignment&#39;</span><span class="p">]</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">fmt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">Q</span><span class="p">[</span><span class="n">j</span><span class="p">,</span><span class="n">t</span><span class="p">](),</span><span class="n">units</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="s1">&#39;t&#39;</span><span class="p">],</span><span class="n">p</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
            
<span class="nb">print</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Final Conditions&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;    Final Inventories:&quot;</span><span class="p">)</span>            
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">STATES</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        </span><span class="si">{0:10s}</span><span class="s2">  </span><span class="si">{1:6.1f}</span><span class="s2"> kg&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="n">model</span><span class="o">.</span><span class="n">S</span><span class="p">[</span><span class="n">s</span><span class="p">,</span><span class="n">H</span><span class="p">]()))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>--------------------------------------------------------------------------------------------

Starting Conditions
    Initial Inventories:
        Feed_A       500.0 kg
        Feed_B       500.0 kg
        Feed_C       500.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

--------------------------------------------------------------------------------------------

Time = 0 hr
    Instructions:
        Assign Heater with capacity 100 kg to task Heating for 1 hours
        Transfer 96.0 kg from Feed_A to Heater
        Assign Reactor_2 with capacity 80 kg to task Reaction_1 for 2 hours
        Transfer 40.0 kg from Feed_C to Reactor_2
        Transfer 40.0 kg from Feed_B to Reactor_2
        Assign Reactor_1 with capacity 80 kg to task Reaction_1 for 2 hours
        Transfer 40.0 kg from Feed_C to Reactor_1
        Transfer 40.0 kg from Feed_B to Reactor_1

    Inventories are now:
        Feed_A       404.0 kg
        Feed_B       420.0 kg
        Feed_C       420.0 kg
        Hot_A          0.0 kg
        Int_AB         0.0 kg
        Int_BC         0.0 kg
        Impure_E       0.0 kg
        Product_1      0.0 kg
        Product_2      0.0 kg

    Unit Assignments are now:
        Heater performs the Heating task with a 96.00 kg batch for hour 1.000000 of 1.000000
        Reactor_2 performs the Reaction_1 task with a 80.00 kg batch for hour 1.000000 of 2.000000
        Reactor_1 performs the Reaction_1 task with a 80.00 kg batch for hour 1.000000 of 2.000000

--------------------------------------------------------------------------------------------

Time = 1 hr
    Instructions:
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">Input In [366],</span> in <span class="ni">&lt;cell line: 10&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">S_</span><span class="p">[</span><span class="n">i</span><span class="p">]:</span>
<span class="g g-Whitespace">     </span><span class="mi">19</span>     <span class="k">if</span> <span class="n">t</span><span class="o">-</span><span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">20</span>         <span class="n">amt</span> <span class="o">=</span> <span class="n">rho_</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]</span><span class="o">*</span><span class="n">model</span><span class="o">.</span><span class="n">B</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span><span class="nb">max</span><span class="p">(</span><span class="n">TIME</span><span class="p">[</span><span class="n">TIME</span> <span class="o">&lt;=</span> <span class="n">t</span> <span class="o">-</span> <span class="n">P</span><span class="p">[(</span><span class="n">i</span><span class="p">,</span><span class="n">s</span><span class="p">)]])]()</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>         <span class="k">if</span> <span class="n">amt</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>             <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;        Transfer&quot;</span><span class="p">,</span> <span class="n">amt</span><span class="p">,</span> <span class="s2">&quot;kg from&quot;</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="s2">&quot;to&quot;</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>

<span class="ne">TypeError</span>: &#39;&lt;=&#39; not supported between instances of &#39;list&#39; and &#39;int&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/03"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="03-job-shop-scheduling.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Job Shop Scheduling</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../04/00-uncertainty.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Optimization under Uncertainty</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jeffrey C. Kantor<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>