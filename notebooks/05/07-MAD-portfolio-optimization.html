
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Portfolio Optimization &#8212; CBE 40455/60455 Process Operations</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script src="https://unpkg.com/mermaid/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Log-Optimal Growth and the Kelly Criterion" href="08-Log-Optimal-Growth-and-the-Kelly-Criterion.html" />
    <link rel="prev" title="Portfolio Optimization using Mean Absolute Deviation" href="06-portfolio-optimization-using-mean-absolute-deviation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      
      
      <h1 class="site-logo" id="site-title">CBE 40455/60455 Process Operations</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    CBE 40555/60455 Process Operations
                </a>
            </li>
        </ul>
        <ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../01/syllabus.html">
   CBE 40455/60455 Process Operations: Syllabus
  </a>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../02/00-discrete-event-modeling.html">
   Introduction to Discrete Event Simulation
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/01-simpy.html">
     Introduction to Simpy
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/02-agent-based-models.html">
     Agent Based Models
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/03-queuing-systems.html">
     Simulating Queuing Systems
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../02/04-batch-process-prompt.html">
     Batch Chemical Process
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03/00-scheduling.html">
   Scheduling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/01-critical-path-method.html">
     Critical Path Method
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/02-machine-bottleneck.html">
     Machine Bottleneck
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/03-job-shop-scheduling.html">
     Job Shop Scheduling
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03/07-State-Task-Networks.html">
     Scheduling Multipurpose Batch Processes using State-Task Networks
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../04/00-uncertainty.html">
   Optimization under Uncertainty
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/vendor-problem.html">
     The Vendor Problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/airline-seating.html">
     Airline seat allocation problem
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../04/farmer-project.html">
     Solving the Farmerâ€™s problem
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="00-finance.html">
   Financial Risk and Diversification
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01-measuring-return.html">
     Measuring Return
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03-binomial-model-for-pricing-options.html">
     Binomial Model for Pricing Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="04-real-options.html">
     Real Options
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="05-portfolio-optimization.html">
     Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="06-portfolio-optimization-using-mean-absolute-deviation.html">
     Portfolio Optimization using Mean Absolute Deviation
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     Portfolio Optimization
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="08-Log-Optimal-Growth-and-the-Kelly-Criterion.html">
     Log-Optimal Growth and the Kelly Criterion
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="09-Log-Optimal-Portfolios.html">
     Log-Optimal Portfolios
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/jckantor/cbe60455/main?urlpath=tree/notebooks/05/07-MAD-portfolio-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
      <li>
        <a href="https://colab.research.google.com/github/jckantor/cbe60455/blob/main/notebooks/05/07-MAD-portfolio-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Colab"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_colab.png">
  </span>
<span class="headerbtn__text-container">Colab</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/jckantor/cbe60455"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/jckantor/cbe60455/issues/new?title=Issue%20on%20page%20%2Fnotebooks/05/07-MAD-portfolio-optimization.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/05/07-MAD-portfolio-optimization.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#investment-objectives">
   Investment Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-diversify">
   Why Diversify?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduce-risk-through-law-of-large-numbers">
     Reduce Risk through Law of Large Numbers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#select-a-portfolio-from-a-set-of-candidate-portfolios">
   Select a Portfolio from a Set of Candidate Portfolios
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-historical-data">
     Download Historical Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equally-weighted-portfolio">
     Equally Weighted Portfolio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-component-returns">
     Compute Component Returns
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mad-porfolio">
   MAD Porfolio
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-1-solve-for-dominating-mad-portfolio">
   Problem 1: Solve for Dominating MAD Portfolio
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Portfolio Optimization</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#investment-objectives">
   Investment Objectives
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#why-diversify">
   Why Diversify?
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#reduce-risk-through-law-of-large-numbers">
     Reduce Risk through Law of Large Numbers
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#select-a-portfolio-from-a-set-of-candidate-portfolios">
   Select a Portfolio from a Set of Candidate Portfolios
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#download-historical-data">
     Download Historical Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#equally-weighted-portfolio">
     Equally Weighted Portfolio
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#compute-component-returns">
     Compute Component Returns
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mad-porfolio">
   MAD Porfolio
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#problem-1-solve-for-dominating-mad-portfolio">
   Problem 1: Solve for Dominating MAD Portfolio
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <!--NOTEBOOK_HEADER-->
<p><em>This notebook contains course material from <a class="reference external" href="https://jckantor.github.io/CBE40455">CBE40455</a> by
Jeffrey Kantor (jeff at <a class="reference external" href="http://nd.edu">nd.edu</a>); the content is available <a class="reference external" href="https://github.com/jckantor/CBE40455.git">on Github</a>.
The text is released under the <a class="reference external" href="https://creativecommons.org/licenses/by-nc-nd/4.0/legalcode">CC-BY-NC-ND-4.0 license</a>,
and code is released under the <a class="reference external" href="https://opensource.org/licenses/MIT">MIT license</a>.</em></p>
<!--NAVIGATION-->
<p>&lt; <a class="reference external" href="http://nbviewer.jupyter.org/github/jckantor/CBE40455/blob/master/notebooks/07.06-Portfolio-Optimization-using-Mean-Absolute-Deviation.ipynb">Portfolio Optimization using Mean Absolute Deviation</a> | <span class="xref myst">Contents</span> | <a class="reference external" href="http://nbviewer.jupyter.org/github/jckantor/CBE40455/blob/master/notebooks/07.08-Log-Optimal-Growth-and-the-Kelly-Criterion.ipynb">Log-Optimal Growth and the Kelly Criterion</a> &gt;<p><a href="https://colab.research.google.com/github/jckantor/CBE40455/blob/master/notebooks/07.07-MAD-Portfolio-Optimization.ipynb"><img align="left" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" title="Open in Google Colaboratory"></a><p><a href="https://raw.githubusercontent.com/jckantor/CBE40455/master/notebooks/07.07-MAD-Portfolio-Optimization.ipynb"><img align="left" src="https://img.shields.io/badge/Github-Download-blue.svg" alt="Download" title="Download Notebook"></a></p>
<section class="tex2jax_ignore mathjax_ignore" id="portfolio-optimization">
<h1>Portfolio Optimization<a class="headerlink" href="#portfolio-optimization" title="Permalink to this headline">#</a></h1>
<p>This <a class="reference external" href="http://ipython.org/notebook.html">IPython notebook</a> demonstrates portfolio optimization using the Mean Absolute Deviation (MAD) criterion. A portion of these notes is adapted from <a class="reference external" href="http://en.wikibooks.org/wiki/GLPK/Portfolio_Optimization">GLPK Wikibook tutorial on the subject</a> written by me.</p>
<p>J.C. Kantor (<a class="reference external" href="mailto:Kantor&#46;1&#37;&#52;&#48;nd&#46;edu">Kantor<span>&#46;</span>1<span>&#64;</span>nd<span>&#46;</span>edu</a>)</p>
<p>The latest version of this IPython notebook is available at <a class="reference external" href="http://github.com/jckantor/CBE20255">http://github.com/jckantor/CBE20255</a>  for noncommercial use under terms of the <a class="reference external" href="http://creativecommons.org/licenses/by-nc-sa/4.0/">Creative Commons Attribution Noncommericial ShareAlike License</a>.</p>
<section id="investment-objectives">
<h2>Investment Objectives<a class="headerlink" href="#investment-objectives" title="Permalink to this headline">#</a></h2>
<ul class="simple">
<li><p>Maximize returns</p></li>
<li><p>Reduce Risk through diversification</p></li>
</ul>
</section>
<section id="why-diversify">
<h2>Why Diversify?<a class="headerlink" href="#why-diversify" title="Permalink to this headline">#</a></h2>
<p>Investment portfolios are collections of investments that are managed for overall investment return.  Compared to investing all of your capital into a single asset, maintaining a portfolio of investments allows you to manage risk through diversification.</p>
<section id="reduce-risk-through-law-of-large-numbers">
<h3>Reduce Risk through Law of Large Numbers<a class="headerlink" href="#reduce-risk-through-law-of-large-numbers" title="Permalink to this headline">#</a></h3>
<p>Suppose there are a set of independent investment opportunities that will pay back between 0 and 300% of your original investment, and that all outcomes in that range are equally likely. You have $100,000 to invest.  Should you put it all in one opportunity?  Or should you spread it around?</p>
<p>Here we simulate the outcomes of 1000 trials where we place all the money into a sigle investment of $100,000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W0</span> <span class="o">=</span> <span class="mf">100000.00</span>

<span class="n">Ntrials</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">Profit</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ntrials</span><span class="p">):</span>
    <span class="n">W1</span> <span class="o">=</span> <span class="n">W0</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.00</span><span class="p">)</span>
    <span class="n">Profit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">W1</span> <span class="o">-</span> <span class="n">W0</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">hist</span><span class="p">(</span><span class="n">Profit</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Profit&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;Average Profit = $</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">Profit</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average Profit = $49126
</pre></div>
</div>
<img alt="../../_images/07-MAD-portfolio-optimization_10_1.png" src="../../_images/07-MAD-portfolio-optimization_10_1.png" />
</div>
</div>
<p>As you would expect, about 1/3 of the time there is a loss, and about 2/3 of the time there is a profit. Is this an acceptable investment outcome?</p>
<p>Letâ€™s see what happens if the $100,000 investment over a small number of equal sized investments.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">W0</span> <span class="o">=</span> <span class="mf">100000.00</span>

<span class="n">Ntrials</span> <span class="o">=</span> <span class="mi">10000</span>
<span class="n">Ninvestments</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">Profit</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ntrials</span><span class="p">):</span>
    <span class="n">W1</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([(</span><span class="n">W0</span><span class="o">/</span><span class="n">Ninvestments</span><span class="p">)</span><span class="o">*</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">3.00</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Ninvestments</span><span class="p">)])</span>
    <span class="n">Profit</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">W1</span><span class="o">-</span><span class="n">W0</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">hist</span><span class="p">(</span><span class="n">Profit</span><span class="p">,</span><span class="n">bins</span><span class="o">=</span><span class="mi">100</span><span class="p">);</span>
<span class="n">xlim</span><span class="p">(</span><span class="o">-</span><span class="n">W0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">W0</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Profit&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Frequency&#39;</span><span class="p">)</span>

<span class="nb">print</span> <span class="s2">&quot;Average Profit = $</span><span class="si">{:.0f}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">mean</span><span class="p">(</span><span class="n">Profit</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Average Profit = $50177
</pre></div>
</div>
<img alt="../../_images/07-MAD-portfolio-optimization_12_1.png" src="../../_images/07-MAD-portfolio-optimization_12_1.png" />
</div>
</div>
<p>Even a modest degree of diversification reduces downside risk.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">statsmodels.distributions</span> <span class="kn">import</span> <span class="n">ECDF</span>

<span class="n">ecdf</span> <span class="o">=</span> <span class="n">ECDF</span><span class="p">(</span><span class="n">Profit</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">Profit</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">Profit</span><span class="p">))</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">ecdf</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Profit&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Cumulative Probability&#39;</span><span class="p">)</span>
<span class="n">grid</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_14_0.png" src="../../_images/07-MAD-portfolio-optimization_14_0.png" />
</div>
</div>
</section>
</section>
<section id="select-a-portfolio-from-a-set-of-candidate-portfolios">
<h2>Select a Portfolio from a Set of Candidate Portfolios<a class="headerlink" href="#select-a-portfolio-from-a-set-of-candidate-portfolios" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;AXP&#39;</span><span class="p">,</span><span class="s1">&#39;BA&#39;</span><span class="p">,</span><span class="s1">&#39;CAT&#39;</span><span class="p">,</span><span class="s1">&#39;CSCO&#39;</span><span class="p">,</span><span class="s1">&#39;CVX&#39;</span><span class="p">,</span><span class="s1">&#39;DD&#39;</span><span class="p">,</span><span class="s1">&#39;DIS&#39;</span><span class="p">,</span><span class="s1">&#39;GE&#39;</span><span class="p">,</span> \
        <span class="s1">&#39;GS&#39;</span><span class="p">,</span><span class="s1">&#39;HD&#39;</span><span class="p">,</span><span class="s1">&#39;IBM&#39;</span><span class="p">,</span><span class="s1">&#39;INTC&#39;</span><span class="p">,</span><span class="s1">&#39;JNJ&#39;</span><span class="p">,</span><span class="s1">&#39;JPM&#39;</span><span class="p">,</span><span class="s1">&#39;KO&#39;</span><span class="p">,</span><span class="s1">&#39;MCD&#39;</span><span class="p">,</span> \
        <span class="s1">&#39;MMM&#39;</span><span class="p">,</span><span class="s1">&#39;MRK&#39;</span><span class="p">,</span><span class="s1">&#39;MSFT&#39;</span><span class="p">,</span><span class="s1">&#39;NKE&#39;</span><span class="p">,</span><span class="s1">&#39;PFE&#39;</span><span class="p">,</span><span class="s1">&#39;PG&#39;</span><span class="p">,</span><span class="s1">&#39;T&#39;</span><span class="p">,</span><span class="s1">&#39;TRV&#39;</span><span class="p">,</span> \
        <span class="s1">&#39;UNH&#39;</span><span class="p">,</span><span class="s1">&#39;UTX&#39;</span><span class="p">,</span><span class="s1">&#39;V&#39;</span><span class="p">,</span><span class="s1">&#39;VZ&#39;</span><span class="p">,</span><span class="s1">&#39;WMT&#39;</span><span class="p">,</span><span class="s1">&#39;XOM&#39;</span><span class="p">]</span>

<span class="n">small_portfolio</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;F&#39;</span><span class="p">,</span><span class="s1">&#39;AAPL&#39;</span><span class="p">,</span><span class="s1">&#39;XOM&#39;</span><span class="p">,</span><span class="s1">&#39;PG&#39;</span><span class="p">,</span><span class="s1">&#39;KO&#39;</span><span class="p">]</span>

<span class="n">portfolio</span> <span class="o">=</span> <span class="n">small_portfolio</span>
<span class="n">portfolio</span> <span class="o">=</span> <span class="n">djia</span>
</pre></div>
</div>
</div>
</div>
<section id="download-historical-data">
<h3>Download Historical Data<a class="headerlink" href="#download-historical-data" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pandas.io.data</span>

<span class="n">end</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">today</span><span class="p">()</span><span class="o">.</span><span class="n">date</span><span class="p">()</span>
<span class="n">start</span> <span class="o">=</span> <span class="n">end</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="mi">3</span><span class="o">*</span><span class="mi">365</span><span class="p">)</span>

<span class="n">adjclose</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">io</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">DataReader</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="s2">&quot;yahoo&quot;</span><span class="p">,</span><span class="n">start</span><span class="p">,</span><span class="n">end</span><span class="p">)</span>
    <span class="nb">print</span> <span class="s2">&quot;</span><span class="si">{:5s}</span><span class="s2"> </span><span class="si">{:d}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">s</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
    <span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;Adj Close&#39;</span><span class="p">]</span>
    
<span class="n">adjclose</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">logy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">legend</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Adjusted Close&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Adjusted Close for All Portfolio Assets&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>AXP   754
BA    754
CAT   754
CSCO  754
CVX   754
DD    754
DIS   754
GE    754
GS    754
HD    754
IBM   754
INTC  754
JNJ   754
JPM   754
KO    754
MCD   754
MMM   754
MRK   754
MSFT  754
NKE   754
PFE   754
PG    754
T     754
TRV   754
UNH   754
UTX   754
V     754
VZ    754
WMT   754
XOM   754
</pre></div>
</div>
</div>
</div>
</section>
<section id="equally-weighted-portfolio">
<h3>Equally Weighted Portfolio<a class="headerlink" href="#equally-weighted-portfolio" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P_equal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span> <span class="o">=</span> <span class="n">adjclose</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">P_equal</span> <span class="o">+=</span> <span class="mf">100.0</span><span class="o">*</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">portfolio</span><span class="p">)</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="p">(</span><span class="mf">100.0</span><span class="o">*</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

<span class="n">P_equal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Value&#39;</span><span class="p">);</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Value of an equally weighted portfolio&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_20_0.png" src="../../_images/07-MAD-portfolio-optimization_20_0.png" />
</div>
</div>
</section>
<section id="compute-component-returns">
<h3>Compute Component Returns<a class="headerlink" href="#compute-component-returns" title="Permalink to this headline">#</a></h3>
<p>Arithmetic returns are required because subsequent calculations will be combining returns across components of a portfolio.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#returns = adjclose.diff()[1:]/adjclose[1:]</span>
<span class="n">returns</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">adjclose</span><span class="o">/</span><span class="n">adjclose</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">rmean</span> <span class="o">=</span> <span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mad</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">returns</span><span class="o">-</span><span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="c1"># plug NaN holes due to missing data</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">isnan</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">]):</span>
            <span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">]</span> <span class="o">=</span> <span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span>

<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mf">0.35</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>
<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Returns&#39;</span><span class="p">);</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">returns</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">);</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">returns</span><span class="o">-</span><span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Difference&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_23_0.png" src="../../_images/07-MAD-portfolio-optimization_23_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">std</span><span class="p">(),</span><span class="nb">abs</span><span class="p">(</span><span class="n">returns</span><span class="o">-</span><span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Standard Deviation&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Deviation&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">returns</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()],[</span><span class="mi">0</span><span class="p">,</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span><span class="o">/</span><span class="n">pi</span><span class="p">)</span><span class="o">*</span><span class="n">returns</span><span class="o">.</span><span class="n">std</span><span class="p">()</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>
<span class="n">legend</span><span class="p">([</span><span class="s1">&#39;Portfolio Components&#39;</span><span class="p">,</span><span class="s1">&#39;sqrt(2/pi)&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_24_0.png" src="../../_images/07-MAD-portfolio-optimization_24_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">mad</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">text</span><span class="p">(</span><span class="n">mad</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="mf">1.03</span><span class="p">,</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">s</span><span class="p">)</span>
    
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">mad</span><span class="p">),</span> <span class="nb">min</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">rmean</span><span class="p">)</span><span class="o">-</span><span class="mf">.1</span><span class="o">*</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">rmean</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">rmean</span><span class="p">))]),</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">rmean</span><span class="p">)])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axis</span><span class="p">()</span>
<span class="n">plot</span><span class="p">([</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">);</span>

<span class="c1">#R_equal = P_equal.diff()[1:]/P_equal[1:]</span>
<span class="n">R_equal</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">P_equal</span><span class="o">/</span><span class="n">P_equal</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">M_equal</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">R_equal</span><span class="o">-</span><span class="n">R_equal</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plot</span><span class="p">(</span><span class="n">M_equal</span><span class="p">,</span><span class="n">R_equal</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Risk/Return for an Equally Weighted Portfolio&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Deviation&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Return&#39;</span><span class="p">)</span>

<span class="n">grid</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_25_0.png" src="../../_images/07-MAD-portfolio-optimization_25_0.png" />
</div>
</div>
</section>
</section>
<section id="mad-porfolio">
<h2>MAD Porfolio<a class="headerlink" href="#mad-porfolio" title="Permalink to this headline">#</a></h2>
<p>The linear program is formulated and solved using the pulp package.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip install pulp
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied (use --upgrade to upgrade): pulp in /Users/jeff/anaconda/lib/python2.7/site-packages
Requirement already satisfied (use --upgrade to upgrade): pyparsing&lt;=1.9.9 in /Users/jeff/anaconda/lib/python2.7/site-packages (from pulp)
Cleaning up...
</pre></div>
</div>
</div>
</div>
<p>The decision variables will be indexed by date/time.  The pandas dataframes containing the returns data are indexed by timestamps that include characters that cannot be used by the GLPK solver. Therefore we create a dictionary to translate the pandas timestamps to strings that can be read as members of a GLPK set. The strings denote seconds in the current epoch as defined by python.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t</span> <span class="o">=</span> <span class="p">{</span><span class="n">tstamp</span><span class="p">:</span><span class="s2">&quot;{:</span><span class="si">%s</span><span class="s2">}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tstamp</span><span class="p">)</span> <span class="k">for</span> <span class="n">tstamp</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">}</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pulp</span>

<span class="c1"># mean absolute deviation for the portfolio</span>
<span class="n">m</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="p">(</span><span class="s1">&#39;m&#39;</span><span class="p">,</span> <span class="n">lowBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># dictionary of portfolio weights</span>
<span class="n">w</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">portfolio</span><span class="p">,</span> <span class="n">lowBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># dictionary of absolute deviations of portfolio returns</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">lowBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="o">.</span><span class="n">dicts</span><span class="p">(</span><span class="s1">&#39;z&#39;</span><span class="p">,</span> <span class="n">t</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span> <span class="n">lowBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="c1"># create problem instance</span>
<span class="n">lp</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;MAD Portfolio&#39;</span><span class="p">,</span><span class="n">pulp</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>

<span class="c1"># add objective</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">m</span>

<span class="c1"># calculate mean absolute deviation of portfolio returns</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([(</span><span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">])</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">t</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t</span><span class="p">))</span>

<span class="c1"># relate the absolute deviations to deviations in the portfolio returns</span>
<span class="k">for</span> <span class="n">ts</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">lp</span> <span class="o">+=</span> <span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">ts</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">[</span><span class="n">ts</span><span class="p">]]</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">ts</span><span class="p">]</span><span class="o">-</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">])</span> 
    
<span class="c1"># portfolio weights</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span>

<span class="c1"># bound on average portfolio return</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="o">*</span><span class="n">R_equal</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">lp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="nb">print</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpStatus</span><span class="p">[</span><span class="n">lp</span><span class="o">.</span><span class="n">status</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Optimal
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mf">0.35</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">columns</span><span class="p">)))</span>

<span class="n">ws</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">({</span><span class="n">s</span><span class="p">:</span> <span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">.</span><span class="n">varValue</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">},</span><span class="n">index</span><span class="o">=</span><span class="n">portfolio</span><span class="p">)</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
<span class="n">ws</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Porfolio Weight&#39;</span><span class="p">);</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Returns&#39;</span><span class="p">);</span>

<span class="n">subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
<span class="nb">abs</span><span class="p">(</span><span class="n">returns</span><span class="o">-</span><span class="n">returns</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;barh&#39;</span><span class="p">)</span>
<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Difference&#39;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_32_0.png" src="../../_images/07-MAD-portfolio-optimization_32_0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">P_mad</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">adjclose</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">P_mad</span> <span class="o">+=</span> <span class="mf">100.0</span><span class="o">*</span><span class="n">ws</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">/</span><span class="n">adjclose</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    
<span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="n">P_mad</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">P_equal</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">legend</span><span class="p">([</span><span class="s1">&#39;MAD&#39;</span><span class="p">,</span><span class="s1">&#39;Equal&#39;</span><span class="p">],</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;best&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Unit Value&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.text.Text at 0x10e0bed90&gt;
</pre></div>
</div>
<img alt="../../_images/07-MAD-portfolio-optimization_33_1.png" src="../../_images/07-MAD-portfolio-optimization_33_1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="n">plot</span><span class="p">(</span><span class="n">mad</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="s1">&#39;s&#39;</span><span class="p">)</span>
    <span class="n">text</span><span class="p">(</span><span class="n">mad</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="mf">1.03</span><span class="p">,</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">],</span><span class="n">s</span><span class="p">)</span>
    
<span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">mad</span><span class="p">),</span> <span class="nb">min</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="nb">min</span><span class="p">(</span><span class="n">rmean</span><span class="p">)</span><span class="o">-</span><span class="mf">.1</span><span class="o">*</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">rmean</span><span class="p">)</span><span class="o">-</span><span class="nb">min</span><span class="p">(</span><span class="n">rmean</span><span class="p">))]),</span> <span class="mf">1.1</span><span class="o">*</span><span class="nb">max</span><span class="p">(</span><span class="n">rmean</span><span class="p">)])</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">axis</span><span class="p">()</span>
<span class="n">plot</span><span class="p">([</span><span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]],[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;r--&#39;</span><span class="p">);</span>

<span class="c1">#R_equal = P_equal.diff()[1:]/P_equal[1:]</span>
<span class="n">R_equal</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">P_equal</span><span class="o">/</span><span class="n">P_equal</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">M_equal</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">R_equal</span><span class="o">-</span><span class="n">R_equal</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plot</span><span class="p">(</span><span class="n">M_equal</span><span class="p">,</span><span class="n">R_equal</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="s1">&#39;ro&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="c1">#R_mad = P_mad.diff()[1:]/P_mad[1:]</span>
<span class="n">R_mad</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">P_mad</span><span class="o">/</span><span class="n">P_mad</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
<span class="n">M_mad</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">R_mad</span><span class="o">-</span><span class="n">R_mad</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">portfolio</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">ws</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mf">0.0001</span><span class="p">:</span>
        <span class="n">plot</span><span class="p">([</span><span class="n">M_mad</span><span class="p">,</span><span class="n">mad</span><span class="p">[</span><span class="n">s</span><span class="p">]],[</span><span class="n">R_mad</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">]],</span><span class="s1">&#39;g--&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="p">(</span><span class="n">M_mad</span><span class="p">,</span><span class="n">R_mad</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="s1">&#39;go&#39;</span><span class="p">,</span><span class="n">ms</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

<span class="n">title</span><span class="p">(</span><span class="s1">&#39;Risk/Return for an Equally Weighted Portfolio&#39;</span><span class="p">)</span>
<span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Mean Absolute Deviation&#39;</span><span class="p">)</span>
<span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Mean Return&#39;</span><span class="p">)</span>

<span class="n">grid</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/07-MAD-portfolio-optimization_34_0.png" src="../../_images/07-MAD-portfolio-optimization_34_0.png" />
</div>
</div>
</section>
<section id="problem-1-solve-for-dominating-mad-portfolio">
<h2>Problem 1: Solve for Dominating MAD Portfolio<a class="headerlink" href="#problem-1-solve-for-dominating-mad-portfolio" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lp</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;MAD Portfolio&#39;</span><span class="p">,</span><span class="n">pulp</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">m</span>    
<span class="n">lp</span> <span class="o">+=</span> <span class="n">m</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tmap</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span>

<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">lp</span> <span class="o">+=</span> <span class="n">y</span><span class="p">[</span><span class="n">tsec</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">tsec</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> 
        
<span class="n">lp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">m_min</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">varValue</span>
<span class="n">m_min</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-94-7e6a74985eb9&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;MAD Portfolio&#39;</span><span class="p">,</span><span class="n">pulp</span><span class="o">.</span><span class="n">LpMinimize</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">2</span> <span class="n">lp</span> <span class="o">+=</span> <span class="n">m</span>
<span class="nn">----&gt; 3 lp += m == pulp.lpSum([(y[t] + z[t])/float(len(returns.index)) for t</span> in <span class="ni">tmap.values</span><span class="nt">()])</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> 

<span class="ne">NameError</span>: name &#39;tmap&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Solve for maximum return at minimum MAD</span>

<span class="n">r</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpVariable</span><span class="p">(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">lowBound</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span>

<span class="n">lp</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;MAD Portfolio&#39;</span><span class="p">,</span><span class="n">pulp</span><span class="o">.</span><span class="n">LpMaximize</span><span class="p">)</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">r</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">r</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">m_min</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([(</span><span class="n">y</span><span class="p">[</span><span class="n">t</span><span class="p">]</span> <span class="o">+</span> <span class="n">z</span><span class="p">[</span><span class="n">t</span><span class="p">])</span><span class="o">/</span><span class="nb">float</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">))</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tmap</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
<span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span>
<span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">returns</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">lp</span> <span class="o">+=</span> <span class="n">y</span><span class="p">[</span><span class="n">tsec</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">-</span> <span class="n">z</span><span class="p">[</span><span class="n">tsec</span><span class="p">[</span><span class="n">t</span><span class="p">]]</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">returns</span><span class="p">[</span><span class="n">s</span><span class="p">][</span><span class="n">t</span><span class="p">]</span><span class="o">-</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> 
        
<span class="n">lp</span><span class="o">.</span><span class="n">solve</span><span class="p">()</span>
<span class="n">r_min</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">varValue</span>
<span class="n">w_min</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="n">pulp</span><span class="o">.</span><span class="n">value</span><span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">])</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span> <span class="n">symbols</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="nn">&lt;ipython-input-95-bb19d9078a1c&gt;</span> in <span class="ni">&lt;module&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">lp</span> <span class="o">=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">LpProblem</span><span class="p">(</span><span class="s1">&#39;MAD Portfolio&#39;</span><span class="p">,</span><span class="n">pulp</span><span class="o">.</span><span class="n">LpMaximize</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">6</span> <span class="n">lp</span> <span class="o">+=</span> <span class="n">r</span>
<span class="ne">----&gt; </span><span class="mi">7</span> <span class="n">lp</span> <span class="o">+=</span> <span class="n">r</span> <span class="o">==</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span><span class="o">*</span><span class="n">rmean</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span>
<span class="nn">      8 lp += m_min == pulp.lpSum([(y[t] + z[t])/float(len(returns.index)) for t</span> in <span class="ni">tmap.values</span><span class="nt">()])</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">lp</span> <span class="o">+=</span> <span class="n">pulp</span><span class="o">.</span><span class="n">lpSum</span><span class="p">([</span><span class="n">w</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">symbols</span><span class="p">])</span> <span class="o">==</span> <span class="mf">1.0</span>

<span class="ne">NameError</span>: name &#39;symbols&#39; is not defined
</pre></div>
</div>
</div>
</div>
<!--NAVIGATION-->
<p>&lt; <a class="reference external" href="http://nbviewer.jupyter.org/github/jckantor/CBE40455/blob/master/notebooks/07.06-Portfolio-Optimization-using-Mean-Absolute-Deviation.ipynb">Portfolio Optimization using Mean Absolute Deviation</a> | <span class="xref myst">Contents</span> | <a class="reference external" href="http://nbviewer.jupyter.org/github/jckantor/CBE40455/blob/master/notebooks/07.08-Log-Optimal-Growth-and-the-Kelly-Criterion.ipynb">Log-Optimal Growth and the Kelly Criterion</a> &gt;<p><a href="https://colab.research.google.com/github/jckantor/CBE40455/blob/master/notebooks/07.07-MAD-Portfolio-Optimization.ipynb"><img align="left" src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open in Colab" title="Open in Google Colaboratory"></a><p><a href="https://raw.githubusercontent.com/jckantor/CBE40455/master/notebooks/07.07-MAD-Portfolio-Optimization.ipynb"><img align="left" src="https://img.shields.io/badge/Github-Download-blue.svg" alt="Download" title="Download Notebook"></a></p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/05"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="06-portfolio-optimization-using-mean-absolute-deviation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Portfolio Optimization using Mean Absolute Deviation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="08-Log-Optimal-Growth-and-the-Kelly-Criterion.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Log-Optimal Growth and the Kelly Criterion</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Jeffrey C. Kantor<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>